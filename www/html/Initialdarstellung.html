<!DOCTYPE html>  
 <html>  
      <head>
           <meta charset="UTF-8">
           <title>KO-Phase</title>  
           <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>  
           <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" />  
           <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>  
      </head>  
      <body>  
           <br />  
           <div class="container" style="width:500px;">  
                <h3 align="">KO-Phase</h3><br />                 
                <form method="post"><br/>
                    <label>Begegnungen</label><br><br>
                    <div id="tabelle">
                    <table class="table table-bordered table-striped" id="teams_table">
                        <tr>
                            <th>Team 1</th>
                            <th>Ergebnis</th>
                            <th>Team 2</th>
                        </tr>
                    </table>
                    </div>
                    <br>
                     <input type="submit" name="nächste Runde" value="nächste Runde" class="btn btn-info" /><br />                      
                </form>  
           </div>  
           <br />  
      </body>  
 </html>
<script>
var teamCount=0;
function init(){
    $.ajax({url: "../db/teams.php"}).done(recievedteamnames).fail(ajaxFailed);
}

function recievedteamnames(data){
	teams=JSON.parse(data);
        teams.forEach(addTeamName);
}

function addTeamName(team,teamCount)
{
	if(0==teamCount%2)
		{
			jQuery('<tr></tr>', 
			{
    			id: "tabrow"+teamCount
    		})
			.appendTo("#teams_table");
			jQuery('<td></td>', 
			{
    			id: "tabteam"+teamCount
    		})
			.appendTo("#tabrow"+teamCount);
			$("#tabteam"+teamCount)
				.html(team.name);
			jQuery('<input/>', 
			{
    			id: "teamleft",
				team_id: "'"+team.id+"'",
				type: "number",
				min: "0",
				name:"score",
				style:"width:50px;float:left;",
				class:"form-control"
    		})
			.appendTo("#tabrow"+teamCount);
		}
	else{
			jQuery('<input/>', 
			{
    			id: "teamright",
				team_id: "'"+team.id+"'",
				type: "number",
				min: "0",
				name:"score",
				style:"width:50px;float:right;",
				class:"form-control"
    		})
			.appendTo("#tabrow"+(teamCount-1));
			jQuery('<td></td>', 
			{
    			id: "tabteam"+teamCount
    		})
			.appendTo("#tabrow"+(teamCount-1));
			$("#tabteam"+teamCount)
				.html(team.name);
		}
}

function ajaxFailed(){
	alert("fail");
}	
window.onload=init;
</script>

     $('#begegnungen').on('submit', function (e) {
          e.preventDefault();
          //alert("hallo");
          console.log("test: ", json_content);
          var teamResults = [];
          for (i = 0; i < gameCount; i++) {
               var teamleft = [];
               var teamright = [];
               $(".game_" + i).each(function () {
                    if ($(this).attr("id") == "teamleft") {
                         teamleft["id"] = $(this).attr("team_id");
                         teamleft["result"] = $(this).val();
                    } else {
                         teamright["id"] = $(this).attr("team_id");
                         teamright["result"] = $(this).val();
                    }
               });
               if (teamleft["result"] > teamright["result"]) {
                    teamResults["team_" + teamleft["id"]] = "win";
                    teamResults["team_" + teamright["id"]] = "lose";
               } else if (teamleft["result"] < teamright["result"]) {
                    teamResults["team_" + teamleft["id"]] = "lose";
                    teamResults["team_" + teamright["id"]] = "win";
               }

          }
          console.log("teamResults: ", teamResults);

          $.each(json_content, function (key, value) {
               value.status = teamResults["team_" + value.id];
          });

          console.log("json_content: ", json_content);
          this.submit();
     });
</script>
